(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{9470:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(5497)}])},5497:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return M}});var r=t(2095),i=t(1527),l=t(959),a=t(943),o=t(8685),c=t(950),s=t.n(c),d=t(5178),u=t(3961),h=t(9476),f=t(5794),m=t.n(f);function p(){let e=(0,r._)([""]);return p=function(){return e},e}function y(){let e=(0,r._)(["\n  background: black;\n  display: flex;\n  justify-content: space-between;\n"]);return y=function(){return e},e}function j(){let e=(0,r._)(["\n  padding: 0.5rem;\n"]);return j=function(){return e},e}function x(){let e=(0,r._)(["\n  padding: 0 1.5rem 1.5rem 1.5rem;\n  display: flex;\n"]);return x=function(){return e},e}function g(){let e=(0,r._)(["\n  margin-right: 1rem;\n  position: relative;\n  > input {\n    padding: 0.5rem;\n    border-radius: 0.5rem;\n  }\n"]);return g=function(){return e},e}function w(){let e=(0,r._)(["\n  display: flex;\n  margin: 0.75rem auto;\n  justify-content: space-between;\n"]);return w=function(){return e},e}function b(){let e=(0,r._)(["\n  width: 3.5rem;\n  font-weight: 700;\n  font-size: 0.85rem;\n"]);return b=function(){return e},e}function k(){let e=(0,r._)(["\n  font-size: 1.25rem;\n  font-weight: 700;\n  margin-right: 0.25rem;\n"]);return k=function(){return e},e}function v(){let e=(0,r._)(["\n  padding: 0 1.5rem 1.5rem 1.5rem;\n  width: 100%;\n  /* height: 70vh;\n  overflow-y: scroll; */\n"]);return v=function(){return e},e}function _(){let e=(0,r._)(["\n  border: 1px solid grey;\n  width: 75%;\n"]);return _=function(){return e},e}function Z(){let e=(0,r._)(["\n  width: 100%;\n  border-bottom: 1px solid grey;\n"]);return Z=function(){return e},e}function S(){let e=(0,r._)(["\n  padding: 0.75rem 0;\n  width: ",";\n  border-inline-end: 1px solid #000;\n  border-bottom: 1px solid #000;\n  background: #cccccc;\n  &:nth-child(4) {\n    border-inline-end: none;\n  }\n"]);return S=function(){return e},e}function C(){let e=(0,r._)(["\n  border-top: 1px solid grey;\n"]);return C=function(){return e},e}function E(){let e=(0,r._)(["\n  padding: 0.5rem 0;\n  text-align: center;\n  border-inline-end: 1px solid #000;\n  border-bottom: 1px solid #000;\n  cursor: pointer;\n  &:nth-child(4) {\n    border-inline-end: none;\n    cursor: auto;\n  }\n  > input {\n    padding: 0.25rem;\n  }\n"]);return E=function(){return e},e}function P(){let e=(0,r._)(["\n  text-decoration: underline;\n"]);return P=function(){return e},e}function z(){let e=(0,r._)(["\n  display: flex;\n  justify-content: center;\n"]);return z=function(){return e},e}function O(){let e=(0,r._)(["\n  position: absolute;\n  bottom: 0.25rem;\n  left: ",";\n  color: red;\n  font-size: 0.75rem;\n"]);return O=function(){return e},e}let T=o.ZP.div(p()),N=o.ZP.div(y()),K=o.ZP.div(j()),F=o.ZP.div(x()),$=o.ZP.div(g()),A=o.ZP.div(w()),J=o.ZP.div(b()),L=o.ZP.label(k()),q=o.ZP.div(v()),D=o.ZP.table(_()),G=o.ZP.thead(Z()),I=o.ZP.th(S(),e=>e.width),R=o.ZP.tbody(C()),V=o.ZP.td(E()),X=o.ZP.span(P()),B=o.ZP.div(z()),H=o.ZP.span(O(),e=>e.$left);function M(){let[e,n]=(0,l.useState)("");(0,a.useRouter)();let[t,r]=(0,l.useState)([]),[o,c]=(0,l.useState)([]),[f,p]=(0,l.useState)("zh"),[y,j]=(0,l.useState)("請選擇要刪除的語系"),[x,g]=(0,l.useState)(),[w,b]=(0,l.useState)(),[k,v]=(0,l.useState)(""),[_,Z]=(0,l.useState)({key:""}),[S,C]=(0,l.useState)(!1),[E,P]=(0,l.useState)(!1),[z,O]=(0,l.useState)(!1),[M,Q]=(0,l.useState)(""),[U,W]=(0,l.useState)(""),[Y,ee]=(0,l.useState)({}),[en,et]=(0,l.useState)(!1),[er,ei]=(0,l.useState)(!1),[el,ea]=(0,l.useState)(""),eo=async e=>{let n=await fetch("/api/lang/".concat(e)).then(e=>e.json()).catch(e=>console.error(e));n&&(g(n.data),p(e),b(n.data));let t=await fetch("/api/lang/zh").then(e=>e.json()).catch(e=>console.error(e));ee(t.data)},ec=async e=>{let t=window.confirm("確定要刪除嗎".concat(e,"？"));if(t){try{let n=await fetch("/api/create",{method:"DELETE",body:JSON.stringify({key:e}),headers:{"Content-Type":"application/json"}});if(n){let n={...x};delete n[e],g(n)}else alert("Failed to delete")}catch(e){console.error(e),alert("Failed to delete")}n(""),eo(f)}},es=async()=>{et(!0);let e=await fetch("/api/query/".concat(_.key.trim())).then(e=>e.json());e&&(Z(n=>({...n,...e})),C(!0))},ed=async e=>{et(!1),_.key=e;let n=await fetch("/api/query/".concat(_.key.trim())).then(e=>e.json());n&&(Z(e=>({...e,...n})),C(!0)),C(!0)},eu=async()=>{P(e=>!e)},eh=async()=>{O(!0)},ef=async()=>{let e=/[^A-Za-z0-9_]/.test(M.trim()),n=/\s/.test(M.trim());if(e||n){Q(""),alert("語系及檔名只能包含字母、數字和底線，不能包含特殊符號和空白");return}let t=await fetch("/api/lang/zh").then(e=>e.json());await fetch("/api/lang/".concat(M.trim()),{method:"POST",body:JSON.stringify(t.data),headers:{"content-type":"application/json"}}),em(),Q(""),P(e=>!e)},em=async()=>{let e=await fetch("/api/lang",{method:"GET"}).then(e=>e.json()).catch(e=>console.error(e));if(e){let n=[];e.files.forEach(e=>{n.push({label:e,value:e})});let t=n.filter(e=>"zh"!==e.label);c(t),j("請選擇要刪除的語系"),r(n)}};(0,l.useEffect)(()=>{let e=async()=>{let{files:e}=await fetch("/api/lang",{method:"GET"}).then(e=>e.json()).catch(e=>console.error(e));if(e.sort().reverse(),"zh"!==e[0]){let n=e.indexOf("zh");e.unshift(e.splice(n,1)[0])}if(e){let n=[];e.forEach(e=>{n.push({label:e,value:e})});let t=n.filter(e=>"zh"!==e.label);c(t),r(n),p("zh"),eo("zh")}};e()},[]),(0,l.useEffect)(()=>{eo(f)},[]),(0,l.useEffect)(()=>{""===_.key?(ei(!0),ea("")):ei(!1),ej(_.key)},[_.key]);let ep=async e=>{let n=window.confirm("確定要刪除".concat(e,"語系嗎？"));if(!n){O(!1);return}await fetch("/api/lang/".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}}),em(),eo("zh"),O(!1)},ey=e=>{let n=e.target.value;ej(n),Z(e=>({...e,key:n}))},ej=e=>{let n=e.length,t=/^[0-9]/.test(_.key.trim());/^[0-9a-zA-Z_.]*$/g.test(e)||(ei(!0),ea("key值只允許輸入「數字」、「字母」或下底線符號「 _ 」以及「 . 」")),n>30&&(ei(!0),ea("超過最大字數(上限 30 字)")),t&&(ei(!0),ea("Key 值不能以數字開頭"))};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(m(),{children:[(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,i.jsx)("title",{children:"多語系設定頁面"})]}),(0,i.jsxs)(T,{children:[(0,i.jsxs)(N,{children:[(0,i.jsxs)(K,{children:[(0,i.jsx)(s(),{onClick:eu,style:{margin:"1.5rem"},ghost:!0,children:"新增語系檔"}),(0,i.jsx)(s(),{onClick:eh,style:{margin:"1.5rem"},ghost:!0,danger:!0,children:"刪除語系檔"})]}),(0,i.jsx)(K,{children:(0,i.jsx)(s(),{onClick:()=>{localStorage.removeItem("password"),localStorage.removeItem("user"),window.location.href="/login"},style:{margin:"1.5rem"},type:"primary",children:"登出"})})]}),(0,i.jsx)("br",{}),(0,i.jsxs)($,{children:[(0,i.jsx)(L,{style:{marginLeft:"1.5rem"},children:"Key: "}),(0,i.jsx)(h.Z,{value:_.key,style:{width:"15rem",padding:"0.25rem 0.25rem 0.25rem 0.5rem"},onChange:ey,placeholder:"請輸入key"}),er&&(0,i.jsx)(H,{$left:"5rem",children:el}),(0,i.jsx)(s(),{onClick:es,style:{margin:"1.5rem"},type:"primary",disabled:er,children:"新增 Key & Value"})]}),(0,i.jsxs)(F,{children:[(0,i.jsx)(L,{children:"選擇當前顯示的語系檔："}),(0,i.jsx)(u.Z,{value:f,style:{width:"15rem"},onChange:eo,options:t})]}),(0,i.jsxs)(F,{children:[(0,i.jsx)(L,{children:"搜尋Key值："}),(0,i.jsx)(h.Z,{value:e,placeholder:"請輸入Key值",style:{width:"15rem"},onChange:e=>{let t=e.target.value.trim();if(n(t),!w)return;if(""===t){eo(f);return}let r={};Object.keys(w).forEach(e=>{e.includes(t)&&(r[e]=w[e])}),g(r)}})]}),(0,i.jsx)(q,{children:(0,i.jsxs)(D,{children:[(0,i.jsx)(G,{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)(I,{width:"20%",children:"Key"}),(0,i.jsx)(I,{width:"40%",children:"Value"}),(0,i.jsx)(I,{width:"20%",children:"zh參考"}),(0,i.jsx)(I,{width:"15%",children:"Options"})]})}),(0,i.jsx)(R,{children:x&&Object.keys(x).sort().map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)(V,{onClick:()=>ed(e),children:(0,i.jsxs)(X,{children:[" ",e]})}),(0,i.jsxs)(V,{onClick:()=>ed(e),children:[k===e&&(0,i.jsx)("input",{value:x[e],onChange:n=>{g({...x,[e]:n.target.value})}}),k!==e&&x[e]]}),(0,i.jsx)(V,{onClick:()=>ed(e),children:Y[e]}),(0,i.jsx)(V,{children:k!==e&&(0,i.jsx)(B,{children:(0,i.jsx)(s(),{danger:!0,onClick:()=>ec(e),size:"small",children:"刪除"})})})]},e))})]})}),(0,i.jsx)(d.Z,{title:en?"Add 新增":"Edit 編輯",open:S,onOk:async()=>{if(er){alert("請輸入正確格式的key值");return}let e=await fetch("/api/create",{method:"POST",body:JSON.stringify(_),headers:{"content-type":"application/json"}});e?(Z({key:""}),alert("saved all"),eo(f),C(!1)):alert("Error")},onCancel:()=>{C(!1),Z({key:""})},children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)($,{children:[(0,i.jsx)(L,{children:"Key: "}),(0,i.jsx)(h.Z,{value:_.key,style:{width:"15rem",padding:"0.25rem 0.25rem 0.25rem 0.5rem",marginBottom:" 1.5rem"},onChange:ey,placeholder:"請輸入key"}),er&&(0,i.jsx)(H,{$left:"3rem",children:el})]}),(null!=t?t:[]).map((e,n)=>(0,i.jsxs)(A,{children:[(0,i.jsx)(J,{children:e.label}),(0,i.jsx)(h.Z,{value:_[e.label],style:{width:"90%",marginRight:"0.75rem"},onChange:n=>Z(t=>({...t,[e.label]:n.target.value})),placeholder:"請輸入 value"})]},n))]})}),(0,i.jsx)(d.Z,{title:"新增語系",width:800,open:E,onCancel:()=>{P(!1),Q("")},onOk:ef,children:(0,i.jsxs)($,{children:[(0,i.jsx)(L,{children:"語系："}),(0,i.jsx)("input",{value:M,onChange:e=>Q(e.target.value),placeholder:"請輸入語系及檔名"})]})}),(0,i.jsx)(d.Z,{title:"刪除語系",width:800,open:z,onCancel:()=>{O(!1),j("請選擇要刪除的語系")},onOk:()=>ep(y),children:(0,i.jsx)(F,{children:(0,i.jsx)(u.Z,{value:y,style:{width:"15rem"},onChange:e=>{j(e)},options:o})})})]})]})}}},function(e){e.O(0,[620,947,774,888,179],function(){return e(e.s=9470)}),_N_E=e.O()}]);